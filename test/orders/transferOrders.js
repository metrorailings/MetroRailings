// ----------------- APP_ROOT_PATH INSTANTIATION --------------------------

global.OwlStakes =
{
	require : require('app-root-path').require
};

// ----------------- EXTERNAL MODULES --------------------------

let mongo = global.OwlStakes.require('data/DAO/utility/databaseDriver'),
	ordersDAO = global.OwlStakes.require('data/DAO/orders');

// ----------------- ENUMS/CONSTANTS --------------------------

const ORDERS_COLLECTION = 'orders',
	DOCUMENT_TO_BUILD = '{"_id":1950,"notes":{"order":"We propose to fabricate and install interior cable railings, two gates, and handrails for the living room area of the house.  The railing frame will be build out of heavy duty aluminum stock and colored off with any powder coated finish.  We will also fabricate two Cable Gates (5Ft and 3FT) as well as handrails for the walls as you go up the stairs.  The cables will be made of 1/8” thick stainless steel cables and stainless steel caps.  <br /><br />Approximate Delivery for this job is 3 weeks.<br /><br />Price Breakdown:<br />Cable Railing: \\t$ 1,155<br />5 FT Gate: \\t\\t$ 1,125<br />3 FT Gate:\\t\\t$ 675<br />8 FT Handrails:\\t$ 600<br />5 FT Handrail:\\t$ 375 (kitchen entrance)<br /><br />Total: $ 3,930 + Tax<br /><br />If you have any question please feel free to contact me by email or phone.<br /><br /><br />Thanks!<br /><br />Wilson Paredes<br />Metro Railings","internal":[{"note":"Everything is good. The customer is very happy.","author":"kinsho","date":"2019-07-16T16:25:59.568Z"},{"note":"Sent to the shop for fabrication ","author":"wparedes","date":"2019-07-01T18:46:44.536Z"},{"note":"Interior Cable Railings & Gates: <br />-7 FT Cable Railings<br />-5 FT Cable Gate<br />-3 FT Cable Gate<br />-8 FT Handrail<br />-5 FT Handrail at kitchen entrance ","author":"wparedes","date":"2019-06-24T16:17:41.261Z"}]},"customer":{"name":"Melissa Barruel","email":"mabarruel@hotmail.com","areaCode":"732","phoneOne":"407","phoneTwo":"9789","address":"9 Ivy Court","aptSuiteNo":"","city":"Metuchen ","state":"NJ","zipCode":"08840","nickname":"Melissa","aptSuiteNumber":""},"status":"closed","lastModifiedDate":"2019-07-16T16:25:59.568Z","modHistory":[{"user":"wparedes","date":"2019-06-24T21:55:25.054Z"},{"user":"wparedes","date":"2019-06-24T16:17:41.261Z"},{"user":"system","date":"2019-06-25T00:45:16.657Z"},{"user":"wparedes","date":"2019-07-01T18:46:44.536Z"},{"user":"kinsho","date":"2019-07-16T16:25:59.568Z"}],"conception":{"userType":"admin","user":"wparedes"},"length":7,"finishedHeight":36,"additionalFeatures":"5 FT Gate\\n3 FT Gate\\n8 FT Handrails \\n5 FT Handrail for kitchen entrance ","agreement":["By completing this order form and signing this agreement (collectively, the “Agreement”), you are entering into a transaction between you and Metro Railings, a company that specializes in the manufacture and installation of railings and gates (the “Products”) at the specified location below (the “Installation Address”).","##### Term","This Agreement shall begin upon execution and end once the Products are installed at the Installation Address to the specifications listed out on this order form.","##### Customization","The Products will be manufactured and installed according to the design specifications provided and agreed to by you and Metro Railings on this order form.","##### Payment","You agree to pay Metro Railings for its services related to the manufacturing and/or installation of the Products and any other services specified on this order form (the “Order Total”) on this order form.","**A. Initial Deposit**  \\nYou agree to pay Metro Railings 50% of the Order Total upon signing this Agreement (the “Initial Deposit”) and understand that Metro Railings will have no obligation to begin work for you until this Initial Deposit is paid and processed by Metro Railings. By signing this Agreement, you understand that Metro Railings produces its Products based on customized specifications for its customers and that this initial deposit may be non-refundable once work has begun according to this order form.","**B. Balance**  \\nUpon completion of the work specified in this order form, you agree to pay off the remaining balance of the Order Total, minus the Initial Deposit and other payments toward the Order Total paid. In the event that you require additional services from Metro Railings, you will be required to complete and sign a new order form with Metro Railings, which will require an additional deposit to be paid.","**C. Credit Card Payments**  \\nIn the event that you pay your Initial Deposit by credit card, you agree to allow Metro Railings to automatically charge the remaining balance of the Order Total upon installation of the Products at the Installation Address, unless you instruct Metro Railings otherwise before the remaining balance becomes due.","**D. Order Total**  \\nThe Order Total in this order form covers the entire cots of this order, including installation, limited warranties, and taxes. In the event that measurements of the area on which the Products are meant to cover fall short due to the miscalculation of Metro Railings or its representative, Metro Railings agrees to provide up to ten extra feet of Products at no additional cost to cover the extra space required by you and/or inspection codes.","##### Acceptance","You agree that your payment of the remaining balance of the Order Total shall serve as an acceptance of the work completed by Metro Railings. In the event that you fail to pay the remaining balance, or if your payment fails to process successfully to Metro Railings, Metro Railings reserves the right to take back its Products and use any and all rights and remedies available to it at law.","##### Limited Warranties","Metro Railings agrees to provide a limited lifetime warranty on any aluminum Products it manufactures and a one-year limited warranty on the powder coating applied to any of these aluminum Products. However, any and all warranties provided by Metro Railings solely cover manufacturing defects as well as normal wear and tear caused over time and do not cover damages to the Products through external forces such as storms, accidents, or acts of God.","##### Disclaimer","You understand that Metro Railings may drill holes in order to anchor its Products into any platform or ground that the Products will be standing upon and agree to hold Metro Railings harmless for the drilled holes created. You accept that Metro Railings will not be responsible for filling in any holes created in the event that you decide not to use the Products that the holes were created for.","##### Additional Costs.","If the platform or ground on which the Products being installed require Metro Railings to drill through rebar or granite, you agree to pay an additional $60 for each hole drilled through the rebar or granite. You understand that this additional cost is necessary not only because of the additional time required for drilling holes into rebar or granite, but also because  of the excessive wear and tear it causes on Metro Railings’ drilling equipment. ","##### Governing Law","This Agreement shall be governed by the laws of New Jersey.","##### Force Majeure","Metro Railings will not be liable for any delay or failure to perform its obligations under this Agreement by any reason, event, or other matter beyond its reasonable control, including, but not limited to, acts of state or governmental authorities, acts of terrorism, natural catastrophe, fire, storm, flood, earthquakes, accident, and prolonged shortage of energy. Entire Agreement. This Agreement contains all of the terms agreed to between you and Metro Railings and supersedes any prior and verbal agreements made between you and any representative of Metro Railings.","##### Headings","The section headings contained in this Agreement are for reference purposes only and shall not affect in any way the meaning or interpretation of this Agreement.","##### Binding Agreement","The provisions of this Agreement will be binding upon, and will inure to the benefit of, the respective heirs, legal representatives, successors and assigns of the parties."],"timeLimit":{"original":45,"extension":"","rawDueDate":"2019-08-09T00:45:16.658Z","translatedDueDate":"August 9th, 2019"},"installation":{"platformType":"wood","coverPlates":true},"pricing":{"pricePerFoot":165,"additionalPrice":2775,"deductions":0,"isTaxApplied":true,"isTariffApplied":false,"subTotal":3930,"tax":260.36,"tariff":0,"orderTotal":4190.36,"balanceRemaining":2095.1899999999996,"taxRemaining":0,"modification":0,"restByCheck":false},"design":{"post":"Rectangular 3\\" x 1\\"","handrailing":"Rectangular 3\\" x 1\\"","picket":"","postEnd":"","postCap":"Extension","center":"Stainless steel cables","color":"Metallic Bronze"},"createDate":"2019-06-24T21:55:25.054Z","pictures":[{"name":"1950-1562006743025-1950- Melissa Barruel.png","path_lower":"/orders/1950-1562006743025-1950- melissa barruel.png","path_display":"/orders/1950-1562006743025-1950- Melissa Barruel.png","id":"id:Uhj4dMOjo3AAAAAAAAABzg","client_modified":"2019-07-01T18:45:43Z","server_modified":"2019-07-01T18:45:44Z","rev":"27e5c816c6b","size":109134,"is_downloadable":true,"content_hash":"b9531fc51b046cd5bda3b8e80908495b35451ca43797e2d447e12b4648e34ba4","shareLink":"https://dl.dropboxusercontent.com/s/8cfm7v6di3pncff/1950-1562006743025-1950-%20melissa%20barruel.png?dl=0"}],"ccToken":"tok_1Ep2meIZYp4JZqQH9H0Y5Uc3","finalizationDate":"2019-06-25T00:45:16.658Z","stripe":{"customer":"cus_FJg8ep6H7fHe1h","charges":["ch_1Ep2mfIZYp4JZqQHTMjjqPKf","ch_1EwtTZIZYp4JZqQHj501KcAv"]},"rushOrder":null}';

// ----------------- INITIALIZATION --------------------------

// Open up a connection to the database
(async function ()
{
	await mongo.initialize();

	if (process.argv.length < 2)
	{
		console.log('Not enough arguments...');
		process.exit();
	}

	// Pull the number of orders needed and the date that we should use as a base to generate new dates
	let orderId = parseInt(process.argv[2], 10),
		order = await ordersDAO.searchOrderById(orderId),
		newOrders = [];

	newOrders.push(order);
	newOrders.unshift(ORDERS_COLLECTION, true);

	// Send all these orders to the database
	await mongo.bulkWrite.apply(mongo, newOrders);

	// Close out this program
	console.log('Done!');
	process.exit();
})();